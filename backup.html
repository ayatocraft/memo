<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è»¢é€ - ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/ably/browser/static/ably.min.js"></script>
<style>
body { font-family:"Segoe UI","Noto Sans JP",sans-serif; background:#f3f4f6; margin:0; padding:0; }
.container { max-width:700px; margin:40px auto; background:#fff; padding:24px; border-radius:16px; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
h1 { text-align:center; margin-bottom:25px; font-size:1.8em; }
.section { background:#f9fafb; border-radius:12px; padding:20px; margin-top:20px; }
.status { margin-top:8px; padding:8px; border-radius:8px; font-size:14px; background:#eee; }
.status.ok { background:#d1fae5; color:#065f46; }
.status.wait { background:#fef3c7; color:#92400e; }
.status.err { background:#fee2e2; color:#991b1b; }
button { border:none; padding:10px 18px; border-radius:8px; background:#0078d7; color:white; font-size:15px; cursor:pointer; transition:0.2s; }
button:hover { background:#005fa3; }
button.secondary { background:#ccc; color:#000; }
input[type=text] { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-top:5px; font-size:14px; }
.info-btn { position:absolute; top:10px; right:10px; background:transparent; font-size:22px; color:#666; cursor:pointer; }
#infoModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; }
#infoContent { background:white; padding:20px; border-radius:12px; max-width:500px; line-height:1.6; }
#infoContent h2 { margin-top:0; }
#infoContent button { background:#0078d7; color:white; float:right; }
</style>
</head>
<body>
<div class="container">
    <button class="info-btn" id="infoBtn">â„¹ï¸</button>
    <h1>ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è»¢é€</h1>

    <div class="section">
        <h2>ğŸ“¥ å—ä¿¡å´æƒ…å ±</h2>
        <p>ã“ã®PeerIDã‚’é€ä¿¡å´ã«ä¼ãˆã¦ãã ã•ã„ï¼š</p>
        <p><b id="myPeerId">ç”Ÿæˆä¸­...</b></p>
        <div id="receiveStatus" class="status wait">å—ä¿¡å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="section">
        <h2>ğŸ“¤ é€ä¿¡å´</h2>
        <p>å—ä¿¡å´PeerIDã‚’å…¥åŠ›ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’é€ä¿¡ï¼š</p>
        <input type="text" id="targetPeerId" placeholder="å—ä¿¡å´PeerIDã‚’å…¥åŠ›">
        <button id="sendBackupBtn">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼†é€ä¿¡</button>
        <div id="sendStatus" class="status"></div>
    </div>

    <div style="text-align:center; margin-top:20px;">
        <button class="secondary" onclick="window.location.href='home.html'">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
    </div>
</div>

<!-- Infoãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="infoModal">
    <div id="infoContent">
        <h2>â„¹ï¸ ä½¿ã„æ–¹</h2>
        <ul>
            <li>å—ä¿¡å´ã¯ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€PeerIDã‚’æ§ãˆã¾ã™ã€‚</li>
            <li>é€ä¿¡å´: å—ä¿¡å´PeerIDã‚’å…¥åŠ› â†’ ã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼†é€ä¿¡ã€ã€‚</li>
            <li>å—ä¿¡å´ã¯ãƒœã‚¿ãƒ³ä¸è¦ã§è‡ªå‹•å—ä¿¡ã•ã‚Œã¾ã™ã€‚</li>
            <li>å—ä¿¡å®Œäº†å¾Œã€localStorage ã«å¾©å…ƒã•ã‚Œã¾ã™ã€‚</li>
            <li>Wi-FiãŒç•°ãªã£ã¦ã„ã¦ã‚‚Ablyã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§é€å—ä¿¡å¯èƒ½ã§ã™ã€‚</li>
        </ul>
        <button id="closeInfo">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
const ably = new Ably.Realtime({ key:"m4nEkQ.t_3fkw:CyxgDJS1Z5J8b6FAiCxkO1F-t7cLQGIxmfin9BzL" });
const myPeerIdEl = document.getElementById("myPeerId");
const receiveStatus = document.getElementById("receiveStatus");
const targetPeerInput = document.getElementById("targetPeerId");
const sendBackupBtn = document.getElementById("sendBackupBtn");
const sendStatus = document.getElementById("sendStatus");
const infoBtn = document.getElementById("infoBtn");
const infoModal = document.getElementById("infoModal");
const closeInfo = document.getElementById("closeInfo");

let myPeerId = ably.auth.clientId || "peer_" + Math.floor(Math.random()*10000);
myPeerIdEl.textContent = myPeerId;
let receivedData = null;

// Infoãƒ¢ãƒ¼ãƒ€ãƒ«
infoBtn.onclick = ()=> infoModal.style.display="flex";
closeInfo.onclick = ()=> infoModal.style.display="none";
infoModal.onclick = e=>{if(e.target===infoModal) infoModal.style.display="none"}

// å—ä¿¡å´è³¼èª­ (PeerIDã‚’ãƒãƒ£ãƒ³ãƒãƒ«åã¨ã—ã¦ä½¿ç”¨)
const receiveChannel = ably.channels.get("backup_" + myPeerId);
receiveChannel.subscribe("backup", msg=>{
    receivedData = msg.data;
    try{
        const json = JSON.parse(receivedData.data);
        for(const key in json) localStorage.setItem(key,json[key]);
        receiveStatus.textContent = "âœ… å—ä¿¡å®Œäº† (é€ä¿¡å…ƒ: "+receivedData.senderId+")";
        receiveStatus.className="status ok";
        alert("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å—ä¿¡ã—ã¾ã—ãŸ");
    }catch(e){
        receiveStatus.textContent="âŒ ãƒ‡ãƒ¼ã‚¿å—ä¿¡ã‚¨ãƒ©ãƒ¼";
        receiveStatus.className="status err";
        console.error(e);
    }
});

// é€ä¿¡å‡¦ç†
sendBackupBtn.onclick = async ()=>{
    const targetPeerId = targetPeerInput.value.trim();
    if(!targetPeerId) return alert("å—ä¿¡å´PeerIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    sendStatus.textContent="â³ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”Ÿæˆä¸­...";
    sendStatus.className="status wait";
    try{
        const data = JSON.stringify(localStorage);
        const fileName = "backup_"+new Date().toISOString().slice(0,10)+".dat";
        const sendChannel = ably.channels.get("backup_" + targetPeerId);
        await sendChannel.publish("backup",{ senderId: myPeerId, fileName, data });
        sendStatus.textContent=`âœ… é€ä¿¡å®Œäº† (${fileName})`;
        sendStatus.className="status ok";
    }catch(e){
        sendStatus.textContent="âŒ é€ä¿¡å¤±æ•—";
        sendStatus.className="status err";
        console.error(e);
    }
};
</script>
</body>
</html>


<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è»¢é€ - ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/ably/browser/static/ably.min.js"></script>
<style>
body { font-family: "Segoe UI","Noto Sans JP",sans-serif; background:#f3f4f6; margin:0; padding:0; }
.container { max-width:600px; margin:40px auto; background:#fff; padding:24px; border-radius:16px; box-shadow:0 5px 20px rgba(0,0,0,0.1); position:relative; }
h1 { text-align:center; margin-bottom:20px; }
.section { background:#f9fafb; border-radius:12px; padding:20px; margin-top:15px; }
.status { margin-top:8px; padding:8px; border-radius:8px; font-size:14px; background:#eee; }
.status.ok { background:#d1fae5; color:#065f46; }
.status.wait { background:#fef3c7; color:#92400e; }
.status.err { background:#fee2e2; color:#991b1b; }
button { border:none; padding:10px 16px; border-radius:8px; background:#0078d7; color:white; font-size:15px; cursor:pointer; transition:0.2s; }
button:hover { background:#005fa3; }
button.secondary { background:#ccc; color:#000; }
input[type=text] { width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-top:5px; }
.info-btn { position:absolute; top:10px; right:10px; background:transparent; font-size:22px; color:#666; cursor:pointer; }
#infoModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; }
#infoContent { background:white; padding:20px; border-radius:12px; max-width:500px; line-height:1.6; }
#infoContent h2 { margin-top:0; }
#infoContent button { background:#0078d7; color:white; float:right; }
</style>
</head>
<body>
<div class="container">
    <button class="info-btn" id="infoBtn">â„¹ï¸</button>
    <h1>ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è»¢é€</h1>

    <div class="section">
        <h2>ğŸ“¥ å—ä¿¡å´æƒ…å ±</h2>
        <p>ã“ã®IDã‚’é€ä¿¡å´ã«ä¼ãˆã¦ãã ã•ã„ï¼š</p>
        <p><b id="myId">ç”Ÿæˆä¸­...</b></p>
        <div id="receiveStatus" class="status wait">å—ä¿¡å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="section">
        <h2>ğŸ“¤ é€ä¿¡å´</h2>
        <p>å—ä¿¡å´IDã‚’å…¥åŠ›ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’é€ä¿¡ï¼š</p>
        <input type="text" id="targetId" placeholder="å—ä¿¡å´IDã‚’å…¥åŠ›">
        <button id="sendBackupBtn">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼†é€ä¿¡</button>
        <div id="sendStatus" class="status"></div>
    </div>

    <div style="text-align:center; margin-top:20px;">
        <button class="secondary" onclick="window.location.href='home.html'">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
    </div>
</div>

<!-- Infoãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="infoModal">
    <div id="infoContent">
        <h2>â„¹ï¸ ä½¿ã„æ–¹</h2>
        <ul>
            <li>å—ä¿¡å´ã¯ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦IDã‚’æ§ãˆã¾ã™ã€‚</li>
            <li>é€ä¿¡å´: å—ä¿¡å´IDã‚’å…¥åŠ› â†’ ã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼†é€ä¿¡ã€ã€‚</li>
            <li>å—ä¿¡å´ã¯ãƒœã‚¿ãƒ³ä¸è¦ã§è‡ªå‹•å—ä¿¡ã•ã‚Œã¾ã™ã€‚</li>
            <li>å—ä¿¡å®Œäº†å¾Œã€localStorage ã«å¾©å…ƒã•ã‚Œã¾ã™ã€‚</li>
            <li>Wi-FiãŒç•°ãªã£ã¦ã„ã¦ã‚‚Ablyã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§é€å—ä¿¡å¯èƒ½ã§ã™ã€‚</li>
        </ul>
        <button id="closeInfo">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
const ably = new Ably.Realtime("m4nEkQ.t_3fkw:CyxgDJS1Z5J8b6FAiCxkO1F-t7cLQGIxmfin9BzL");

const myIdEl = document.getElementById("myId");
const receiveStatus = document.getElementById("receiveStatus");
const sendBackupBtn = document.getElementById("sendBackupBtn");
const sendStatus = document.getElementById("sendStatus");
const targetIdInput = document.getElementById("targetId");
const infoBtn = document.getElementById("infoBtn");
const infoModal = document.getElementById("infoModal");
const closeInfo = document.getElementById("closeInfo");

// IDç”Ÿæˆ
let myId = "memo_" + Math.floor(Math.random()*10000);
myIdEl.textContent = myId;
let receivedData = null;

// Infoãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
infoBtn.onclick = ()=> infoModal.style.display="flex";
closeInfo.onclick = ()=> infoModal.style.display="none";
infoModal.onclick = e => { if(e.target===infoModal) infoModal.style.display="none"; }

// å—ä¿¡å´è³¼èª­
const channel = ably.channels.get(myId);
channel.subscribe("backup", msg => {
    receivedData = msg.data;
    try{
        const json = JSON.parse(receivedData.data);
        for(const key in json) localStorage.setItem(key,json[key]);
        receiveStatus.textContent = "âœ… å—ä¿¡å®Œäº† (é€ä¿¡å…ƒ: "+receivedData.senderId+")";
        receiveStatus.className = "status ok";
        alert("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å—ä¿¡ã—ã¾ã—ãŸ");
    }catch(e){
        receiveStatus.textContent="âŒ ãƒ‡ãƒ¼ã‚¿å—ä¿¡ã‚¨ãƒ©ãƒ¼";
        receiveStatus.className="status err";
        console.error(e);
    }
});

// é€ä¿¡å‡¦ç†
sendBackupBtn.onclick = async ()=>{
    const targetId = targetIdInput.value.trim();
    if(!targetId) return alert("å—ä¿¡å´IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    sendStatus.textContent="â³ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”Ÿæˆä¸­...";
    sendStatus.className="status wait";
    try{
        const data = JSON.stringify(localStorage);
        const fileName = "backup_"+new Date().toISOString().slice(0,10)+".dat";
        const targetChannel = ably.channels.get(targetId);
        await targetChannel.publish("backup",{ senderId: myId, fileName, data });
        sendStatus.textContent=`âœ… é€ä¿¡å®Œäº† (${fileName})`;
        sendStatus.className="status ok";
    }catch(e){
        sendStatus.textContent="âŒ é€ä¿¡å¤±æ•—";
        sendStatus.className="status err";
        console.error(e);
    }
};
</script>
</body>
</html>

