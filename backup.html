<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>バックアップオプション - メモアプリ</title>
<style>
body { font-family:"Segoe UI","Noto Sans JP",sans-serif; margin:0; padding:20px; background:#f3f4f6; color:#333;}
.container { max-width:700px; margin:0 auto; background:white; padding:20px 30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
h1 { text-align:center; margin-top:0; }
.section { margin-top:20px; padding:20px; border-radius:10px; background:#f9fafb; border:1px solid #e5e7eb; }
.section h2 { margin-top:0; text-align:center; }
.status { margin-top:20px; padding:10px; border-radius:6px; background:#eee; text-align:center; word-wrap: break-word; }

button.action-btn { width:100%; padding:12px; font-size:16px; cursor:pointer; border:none; border-radius:8px; color:white; margin-top:10px; }
#downloadBackupBtn { background:#28a745; } #downloadBackupBtn:hover { background:#218838; }
#restoreBackupBtn { background:#17a2b8; } #restoreBackupBtn:hover { background:#138496; }
#clearDataBtn { background:#dc3545; } #clearDataBtn:hover { background:#a71d2a; }
#homeBtn { background:#6c757d; } #homeBtn:hover { background:#495057; }
input[type="file"] { display:none; }
</style>
</head>
<body>
<div class="container">
<h1>バックアップオプション</h1>

<div class="section">
<h2>バックアップを作成 / ダウンロード</h2>
<button id="downloadBackupBtn" class="action-btn">ダウンロード</button>
</div>

<div class="section">
<h2>バックアップから復元</h2>
<input type="file" id="backupFileInput" accept=".dat">
<button id="restoreBackupBtn" class="action-btn">復元</button>
</div>

<hr>
<button id="clearDataBtn" class="action-btn">初期化</button>
<button id="homeBtn" class="action-btn">ホームへ戻る</button>

<div id="status" class="status">操作を選択してください</div>
</div>

<script>
window.onload=()=>{
const downloadBtn=document.getElementById('downloadBackupBtn');
const restoreBtn=document.getElementById('restoreBackupBtn');
const backupInput=document.getElementById('backupFileInput');
const clearBtn=document.getElementById('clearDataBtn');
const homeBtn=document.getElementById('homeBtn');
const status=document.getElementById('status');

// --- ダウンロード ---
downloadBtn.onclick=()=>{
  const data={};
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    data[k]=localStorage.getItem(k);
  }
  if(Object.keys(data).length===0){ alert('バックアップデータがありません'); status.textContent='データなし'; return; }
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/dat'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='memo_backup.dat';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  status.textContent='バックアップをダウンロードしました';
};

// --- 復元 ---
restoreBtn.onclick=()=>{ backupInput.click(); };
backupInput.onchange=(e)=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=(ev)=>{
    try{
      const data=JSON.parse(ev.target.result);
      if(confirm('現在のデータをすべて上書きして復元しますか？')){
        localStorage.clear();
        for(const k in data){ localStorage.setItem(k,data[k]); }
        alert('復元完了');
        status.textContent='データ復元完了';
      }
    }catch(err){
      alert('復元に失敗しました: '+err.message);
      status.textContent='復元エラー';
      console.error(err);
    } finally { backupInput.value=null; }
  };
  reader.readAsText(file);
};

// --- 初期化 ---
clearBtn.onclick=()=>{
  if(confirm('localStorageを全て削除して初期化しますか？')){
    localStorage.clear();
    alert('初期化完了');
    status.textContent='データ初期化完了';
  }
};

// --- ホーム ---
homeBtn.onclick=()=>{ location.href='home.html'; };

};
</script>
</body>
</html>
