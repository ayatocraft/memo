<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª</title>
<style>
/* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
body {
    font-family: "Segoe UI", "Noto Sans JP", sans-serif;
    margin: 0;
    background: #f3f4f6;
    color: #333;
    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«é‡ãªã‚‰ãªã„ã‚ˆã†ã« */
    overflow-y: scroll; 
}
/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
#header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 10;
}
#header h1 {
    margin: 0;
    font-size: 24px;
}
.icon-btn {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    line-height: 1;
    transition: background-color 0.2s;
}
.icon-btn:hover {
    background-color: #f0f0f0;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
#main {
    padding: 20px;
}
#memoContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}
.memo-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 15px;
    cursor: pointer;
    transition: box-shadow 0.2s;
    word-wrap: break-word;
    /* ãƒ¡ãƒ¢ãŒé•·ã™ãã‚‹å ´åˆã«å‚™ãˆã‚‹ */
    max-height: 300px;
    overflow: hidden;
}
.memo-card:hover {
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
}
.memo-card-content {
    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®ãŸã‚ã€æ”¹è¡Œã‚’ä¿æŒ */
    white-space: pre-wrap; 
}

/* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ ãƒœã‚¿ãƒ³ */
#addMemoBtn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #0078D7;
    color: white;
    font-size: 36px;
    line-height: 60px;
    text-align: center;
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    cursor: pointer;
    transition: background-color 0.2s;
}
#addMemoBtn:hover {
    background: #005fa3;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« (ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”¨) */
.modal {
    display: none; 
    position: fixed; 
    z-index: 100; 
    left: 0; top: 0;
    width: 100%; height: 100%;
    overflow: auto; 
    background-color: rgba(0,0,0,0.4);
    animation: fadeIn 0.3s;
}
.modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 25px 30px;
    border: 1px solid #888;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    animation: slideIn 0.3s;
}
.close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}
.close-btn:hover {
    color: #000;
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes slideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* (å‰Šé™¤) ãƒ¡ãƒ¢ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‰Šé™¤ */

/* ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« (æ—¢å­˜) */
.profile-section {
    margin-bottom: 25px;
}
.profile-section h3 {
    margin-top: 0;
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
}
.profile-section label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
}
.profile-section select, .profile-section input[type="text"] {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
}
.profile-section button {
    width: 100%;
    padding: 12px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
    font-size: 16px;
    font-weight: 500;
}
.profile-section button:hover {
    background: #218838;
}

</style>
</head>
<body>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div id="header">
    <h1>ãƒ¡ãƒ¢</h1>
    <div>
        <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ (æ—¢å­˜) -->
        <button id="backupBtn" class="icon-btn" title="ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³">ğŸ’¾</button>
        <!-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒœã‚¿ãƒ³ (æ—¢å­˜) -->
        <button id="profileBtn" class="icon-btn" title="ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†">ğŸ‘¤</button>
    </div>
</div>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ (ãƒ¡ãƒ¢ä¸€è¦§) -->
<main id="main">
    <div id="memoContainer">
        <!-- ãƒ¡ãƒ¢ã¯JSã«ã‚ˆã£ã¦ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
    </div>
</main>

<!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ ãƒœã‚¿ãƒ³ -->
<button id="addMemoBtn" title="æ–°ã—ã„ãƒ¡ãƒ¢ã‚’è¿½åŠ ">+</button>

<!-- (å‰Šé™¤) ãƒ¡ãƒ¢ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤ -->

<!-- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« (æ—¢å­˜) -->
<div id="profileModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeProfileModal">&times;</span>
        <h2>ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h2>
        
        <div class="profile-section">
            <h3>ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆ</h3>
            <label for="profileSelect">ç¾åœ¨ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«:</label>
            <select id="profileSelect"></select>
            <small>åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚</small>
        </div>
        
        <div class="profile-section">
            <h3>æ–°ã—ã„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ </h3>
            <label for="newProfileName">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å:</label>
            <input type="text" id="newProfileName" placeholder="ä¾‹: ä»•äº‹ç”¨">
            <button id="addProfileBtn">è¿½åŠ </button>
        </div>
    </div>
</div>


<script>

// === ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† (æ—¢å­˜) ===
let currentProfileName = 'User 1'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
const PROFILE_LIST_KEY = 'memoapp_profiles';
const ACTIVE_PROFILE_KEY = 'memoapp_activeProfileName';

/**
 * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”¨ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ã‚’å–å¾—
 * @param {string} key 'memos' ã¾ãŸã¯ 'settings'
 * @returns {string} åå‰ç©ºé–“ä»˜ãã‚­ãƒ¼ (ä¾‹: 'memoapp_profile_User 1_memos')
 */
function getStorageKey(key) {
    return `memoapp_profile_${currentProfileName}_${key}`;
}

/**
 * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
 * @param {string} key 'memos' ã¾ãŸã¯ 'settings'
 * @returns {string | null}
 */
function loadData(key) {
    return localStorage.getItem(getStorageKey(key));
}

/**
 * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
 * @param {string} key 'memos' ã¾ãŸã¯ 'settings'
 * @param {string} value ä¿å­˜ã™ã‚‹å€¤
 */
function saveData(key, value) {
    localStorage.setItem(getStorageKey(key), value);
}

/**
 * ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‹ã€åˆå›èµ·å‹•æ™‚ã¯åˆæœŸåŒ–
 */
function loadActiveProfile() {
    const profilesJSON = localStorage.getItem(PROFILE_LIST_KEY);
    if (!profilesJSON) {
        // åˆå›èµ·å‹•
        localStorage.setItem(PROFILE_LIST_KEY, JSON.stringify(['User 1']));
        localStorage.setItem(ACTIVE_PROFILE_KEY, 'User 1');
        currentProfileName = 'User 1';
    } else {
        // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼
        const profiles = JSON.parse(profilesJSON);
        const activeProfile = localStorage.getItem(ACTIVE_PROFILE_KEY);
        
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªã‚¹ãƒˆã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
        if (activeProfile && profiles.includes(activeProfile)) {
            currentProfileName = activeProfile;
        } else {
            // å­˜åœ¨ã—ãªã„å ´åˆã€ãƒªã‚¹ãƒˆã®å…ˆé ­ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            currentProfileName = profiles[0] || 'User 1';
            localStorage.setItem(ACTIVE_PROFILE_KEY, currentProfileName);
        }
    }
    // ãƒ‡ãƒãƒƒã‚°ç”¨ã«ã‚¿ã‚¤ãƒˆãƒ«ã«è¡¨ç¤º
    document.title = `ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª (${currentProfileName})`;
}
// === ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã“ã“ã¾ã§ ===


// === ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªæœ¬ä½“ãƒ­ã‚¸ãƒƒã‚¯ ===
window.onload = () => {
    
    // 1. (æœ€å„ªå…ˆ) ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆæœŸåŒ–
    loadActiveProfile();

    // è¦ç´ ã®å–å¾—
    const memoContainer = document.getElementById('memoContainer');
    const addMemoBtn = document.getElementById('addMemoBtn');
    
    // (å‰Šé™¤) ãƒ¡ãƒ¢ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®è¦ç´ å–å¾—ã‚’å‰Šé™¤
    // const editorModal = ...
    // const closeEditorModal = ...
    // const memoEditor = ...
    // const saveMemoBtn = ...
    // const deleteMemoBtn = ...

    // (æ—¢å­˜) ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³
    const backupBtn = document.getElementById('backupBtn');

    // (æ—¢å­˜) ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¦ç´ 
    const profileBtn = document.getElementById('profileBtn');
    const profileModal = document.getElementById('profileModal');
    const closeProfileModal = document.getElementById('closeProfileModal');
    const profileSelect = document.getElementById('profileSelect');
    const newProfileName = document.getElementById('newProfileName');
    const addProfileBtn = document.getElementById('addProfileBtn');

    let memos = [];
    // (å‰Šé™¤) let currentEditingIndex = -1;

    // ãƒ¡ãƒ¢ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã‚€ (ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ)
    function loadMemos() {
        memos = JSON.parse(loadData('memos')) || [];
        renderMemos();
    }

    // (æ³¨æ„) saveMemos ã¯ memo.html å´ã§å¿…è¦ã«ãªã‚Šã¾ã™
    // function saveMemos() {
    //     saveData('memos', JSON.stringify(memos));
    // }

    // ãƒ¡ãƒ¢ä¸€è¦§ã‚’æç”»
    function renderMemos() {
        memoContainer.innerHTML = '';
        if (memos.length === 0) {
            memoContainer.innerHTML = '<p style="color: #666; text-align:center; grid-column: 1 / -1;">ãƒ¡ãƒ¢ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸‹ã®ã€Œ+ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚</p>';
            return;
        }
        
        memos.forEach((memo, index) => {
            const memoCard = document.createElement('div');
            memoCard.className = 'memo-card';
            
            const content = document.createElement('div');
            content.className = 'memo-card-content';
            content.textContent = memo; 
            
            memoCard.appendChild(content);
            
            // (å¤‰æ›´) ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãä»£ã‚ã‚Šã« memo.html ã¸é·ç§»
            memoCard.onclick = () => {
                // memo.html ã«ç·¨é›†å¯¾è±¡ã®IDã‚’æ¸¡ã™
                window.location.href = `memo.html?id=${index}`;
            };
            memoContainer.appendChild(memoCard);
        });
    }

    // (å‰Šé™¤) openEditor é–¢æ•°ã‚’å‰Šé™¤
    // (å‰Šé™¤) closeEditor é–¢æ•°ã‚’å‰Šé™¤

    // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

    // (å¤‰æ›´) +ãƒœã‚¿ãƒ³ã¯ memo.html ã¸ï¼ˆIDãªã—ã§ï¼‰é·ç§»
    addMemoBtn.onclick = () => {
        // IDãªã—ã§é·ç§» = æ–°è¦ãƒ¡ãƒ¢
        window.location.href = 'memo.html';
    };

    // (å‰Šé™¤) ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä¿å­˜ãƒ»å‰Šé™¤ãƒ»é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤
    // closeEditorModal.onclick = ...
    // saveMemoBtn.onclick = ...
    // deleteMemoBtn.onclick = ...

    // --- (æ—¢å­˜) ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”»é¢ã¸ã®é·ç§» ---
    backupBtn.onclick = () => {
        window.location.href = 'backup.html';
    };

    // --- (æ—¢å­˜) ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯ ---

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
    profileBtn.onclick = () => {
        updateProfileSelect();
        profileModal.style.display = 'block';
    };

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    closeProfileModal.onclick = () => {
        profileModal.style.display = 'none';
    };
    
    // (å¤‰æ›´) ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ (ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã¿å¯¾è±¡)
    window.onclick = (event) => {
        if (event.target == profileModal) {
            profileModal.style.display = 'none';
        }
    };

    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateProfileSelect() {
        const profiles = JSON.parse(localStorage.getItem(PROFILE_LIST_KEY) || '["User 1"]');
        profileSelect.innerHTML = '';
        
        profiles.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            if (name === currentProfileName) {
                option.selected = true;
            }
            profileSelect.appendChild(option);
        });
    }

    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ
    profileSelect.onchange = () => {
        const newName = profileSelect.value;
        if (newName !== currentProfileName) {
            localStorage.setItem(ACTIVE_PROFILE_KEY, newName);
            alert(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${newName}ã€ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚`);
            location.reload();
        }
    };

    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
    addProfileBtn.onclick = () => {
        const name = newProfileName.value.trim();
        if (!name) {
            alert('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }

        const profiles = JSON.parse(localStorage.getItem(PROFILE_LIST_KEY) || '["User 1"]');
        
        if (profiles.includes(name)) {
            alert('ãã®åå‰ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚');
            return;
        }
        if (name.length > 50) {
            alert('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åã¯50æ–‡å­—ä»¥å†…ã«ã—ã¦ãã ã•ã„ã€‚');
            return;
        }

        profiles.push(name);
        localStorage.setItem(PROFILE_LIST_KEY, JSON.stringify(profiles));
        
        newProfileName.value = '';
        updateProfileSelect(); // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        
        if (window.confirm(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚\nã™ãã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ`)) {
             localStorage.setItem(ACTIVE_PROFILE_KEY, name);
             location.reload();
        }
    };

    // --- åˆæœŸåŒ– ---
    loadMemos();
};

</script>

</body>
</html>

